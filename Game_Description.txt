Create a python-based text-based RPG, which players can join with their browser over LAN or internet by going to the respective IP adress.  

Settings are read/written to 'settings.json' in the same directoy as the code. Setting include a gemini API key, world style (default: high fantasy) and difficulty (5 levels from trivial to impossible). At all times  players can click the Settings button to choose from a dropdown list, what kind of World Style they like, and what difficulty level they want. They can also change the gemini model to use (retrieve a list of all models from the server to populate the dropdown, no fallsbacks).

At joining, players create character names (default: Hephaest) and describe a short background story (2-3 sentences) (default: "Wizard"). The API acts as Game Master, and, based on World Style and difficulty level, creates a scenario, and then a fitting character class, character abilities (e.g. fireball, backstab), inventory (e.g. sword, leather armor, waterskin) and character conditions (e.g. wounded, wet, dead, healthy). All character abilities also include a property wrt. to the expertise (e.g. novice, expert). Players leave this screen by clicking the 'Enter World' button.

If a player clicks 'Enter World', where a scenario description already exists (game is already running). The playing players are informed, that another player wants to join.
The next time a turn is ended, the API is tasked to come up with a credible in-world story that describes the new player joining in addition to processing everything the already playing players submitted wrt. what attempt to do this turn. The next turn, the joined player(s) count as playing players and the story continues seamlessly. 

Each turn, all players are presented the created scenario and then type into a box what their character attempts to do in the described situation. They can submit this with a button 'Submit' and all players see what the other players submitted. As soon as one player clicks 'Next turn', all prior scenario descriptions from all prior turns, including the current equipment, abilities, and character conditions, world style and difficulty are sent to the API. The API acts as Game Master and creates the next scenario description based on this information, and so on. At any time a player can join by creating a character (name, Background story) and then clicking 'Enter World'. He joins the next turn as described above.
There is no leave button. If a player closes the browser pane, the game registers that he as left.

In addition, the AI, every turn and based on all relevant data, generates a prompt for an image generator. This image generator is gemini-2.5-flash-image-preview. Any player can click on 'Create Image' to make the server contact the image generator API. The client shows that image generation has been started to all players. As soon as the image is generated, it is shown on the screen of all players. Players can mouse-over the image to see the prompt the image is based on.

While the image is generated or a turn is resolved, no buttons can be clicked and are visibly disabled, with a mouse-over text which explains why.
Players only ever see their own abilities, equipment and conditions. They also see a one-word summary describing the condition of their own and any other player characters. This is generated using the text API (gemini-2.5-flash-lite), of course.

With the possible exception of the very first turn, when the world is generated, make sure to only prompt gemini-2.5-flash-lite once per turn and make it output e.g. structured outputs.